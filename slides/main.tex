\documentclass[aspectratio=169]{beamer}

\input{preamble.tex}

\begin{document}

% Title Slide
\begin{frame}
    \titlepage
\end{frame}

% Table of Contents
\begin{frame}{Outline}
    \tableofcontents
\end{frame}

% Section 1: Introduction
\section{Introduction \& Context}

\begin{frame}{Generative Modeling: The Landscape}
    \begin{itemize}
        \item \textbf{Goal}: Learn $p_{data}(x)$ from samples.
        \item \textbf{The Evolution}:
        \begin{itemize}
            \item \textbf{GANs}: Adversarial (Unstable).
            \item \textbf{VAEs}: Approximate (Blurry).
            \item \textbf{Diffusion Models}: 
            \begin{itemize}
                \item High quality.
                \item Slow sampling (many steps).
                \item "Destruction" process (Noise).
            \end{itemize}
        \end{itemize}
    \end{itemize}
\end{frame}

\begin{frame}{The Diffusion Paradigm vs. Flow Matching}
    \centering
    \includegraphics[width=9cm]{imgs/diffusion-vs-flow.png}
    
    \vspace{0.3cm}

    Both approaches try to map noise to data.
    \begin{itemize}
        \item Diffusion models do this with a "destructive" process: adding noise.
        \item Flow Matching do this with a "constructive" process: learning the velocity field.
    \end{itemize}
\end{frame}

\begin{frame}{Intuition: The Vector Field}
    \begin{columns}
        \column{0.5\textwidth}
        \textbf{The core idea:}
        \begin{itemize}
            \item Imagine moving points from a simple distribution (Noise) to a complex one (Data).
            \item We define a \textbf{velocity field} $v_t(x)$ that pushes the points.
            \item By following the arrows, we morph noise into data.
        \end{itemize}
        
        \column{0.5\textwidth}
        \centering
        \begin{center}
            % \includegraphics[width=0.8\textwidth]{path/to/vector_field.png}
            \vspace{4cm} % Placeholder
            \textit{[Insert Image: Vector Field Intuition]}
        \end{center}
    \end{columns}
\end{frame}

% Section 2: Mathematical Formalism
\section{Mathematical Formalism}

\begin{frame}{From Static to Dynamic: The Flow}
    Instead of predicting noise (Diffusion), we predict \textbf{velocity}.
    
    \begin{itemize}
        \item Consider a probability density moving over time $p_t(x)$.
        \item $t=0$: Noise $\mathcal{N}(0, I)$.
        \item $t=1$: Data $p_{data}$.
    \end{itemize}
    
    This movement allows us to define a \textbf{Flow} $\phi_t(x)$, which is the path of a particle $x$:
    $$ \frac{d}{dt}\phi_t(x) = v_t(\phi_t(x)) $$
\end{frame}

\begin{frame}{The Objective: Matching the Vector Field}
    If we knew the ground truth vector field $u_t$ that generates $p_{data}$, we could just regress it:
    $$ \loss_{FM}(\theta) = \E_{t \sim \mathcal{U}[0,1], x \sim p_t(x)} || v_\theta(x) - u_t(x) ||^2 $$
    
    \textbf{Problem}: 
    \begin{itemize}
        \item We don't know $p_t$ (the intermediate distributions).
        \item We don't know $u_t$ (the vector field).
        \item We only have samples from $p_1$ (Data) and can sample $p_0$ (Noise).
    \end{itemize}
\end{frame}

\begin{frame}{Conditional Flow Matching (CFM)}
    \begin{block}{The Key Insight (Lipman et al., 2023)}
        It is hard to match the aggregate flow, but easy to match a \textbf{conditional} flow.
    \end{block}
    
    We assume the total probability path is a mixture of simple paths conditioned on data $x_1$:
    $$ p_t(x) = \int p_t(x|x_1) q(x_1) dx_1 $$
    
    The \textbf{CFM Theorem} states that minimizing the loss w.r.t. the conditional field $u_t(x|x_1)$ is equivalent to minimizing the global FM loss:
    $$ \nabla_\theta \loss_{FM}(\theta) \approx \nabla_\theta \E_{t, x_1, x_0} [ || v_\theta(x_t, t) - u_t(x_t|x_1) ||^2 ] $$
\end{frame}

\begin{frame}{Defining the Conditional Path}
    We need to choose a path $p_t(x|x_1)$ that goes from noise to $x_1$. 
    We choose the \textbf{Optimal Transport} path (straight line):
    
    $$ x_t = (1 - t)x_0 + t x_1, \quad x_0 \sim \mathcal{N}(0, I) $$
    
    The corresponding unique vector field is:
    $$ u_t(x|x_1) = x_1 - x_0 $$
    
    \textbf{Why this choice?}
    \begin{itemize}
        \item \textbf{Simplicity}: Constant velocity for each pair.
        \item \textbf{Efficiency}: Straight paths imply we can take larger steps during sampling (Euler).
        \item \textbf{Stability}: Regression target is bounded and well-behaved.
    \end{itemize}
\end{frame}

% Section 3: Implementation
\section{Implementation}

\begin{frame}[fragile]{Sampling: Solving the ODE}
    \begin{columns}
        \column{0.5\textwidth}
        To generate a sample:
        \begin{enumerate}
            \item Sample noise $x_0 \sim \mathcal{N}(0, I)$.
            \item Numerical Integration from $t=0$ to $1$.
        \end{enumerate}
        
        We used \textbf{Euler Method}:
        $$ x_{t+dt} = x_t + v_\theta(x_t, t) \cdot dt $$
        
        Since our paths are straight (thanks to OT), Euler is surprisingly accurate even with few steps (N=20 to 100).
        
        \column{0.5\textwidth}
        \begin{minted}[fontsize=\footnotesize]{python}
# Pseudocode
x = randn(batch_size, 2)
dt = 1 / steps
for i in range(steps):
    t = i / steps
    # Predict velocity
    v = model(x, t)
    # Update state
    x = x + v * dt
return x
        \end{minted}
    \end{columns}
\end{frame}

\section{Results}

\begin{frame}{Qualitative Results}
    \begin{center}
        \includegraphics[width=0.45\textwidth]{imgs/reconstruction_plot.png}
    \end{center}
    \begin{itemize}
        \item The model successfully learned the distribution.
        \item Trajectories are straight lines with Optimal Transport.
    \end{itemize}
\end{frame}

\begin{frame}{Qualitative Results: CIFAR-10}
    \begin{center}
        \includegraphics[width=0.7\textwidth]{imgs/reconstruction_CIFAR10_.png}
    \end{center}
    \begin{itemize}
        \item Scaling to high-dimensional data using a \textbf{U-Net} backbone.
        \item The model generates sharp samples by following the learned velocity field.
    \end{itemize}
\end{frame}

\input{baptiste.tex}

\begin{frame}
    \centering
    \Huge Thank You!
    \vspace{1cm}
    
    \normalsize
    \textit{Code available at: https://github.com/ArthurCourselle/FlowMatching}
\end{frame}

\end{document}
